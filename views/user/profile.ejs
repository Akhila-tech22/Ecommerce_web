<%- include("../../views/partials/user/header") %>

<link href="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <head>
    <link rel="stylesheet" href="css/linearicons.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/themify-icons.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/owl.carousel.css">
    <link rel="stylesheet" href="css/nice-select.css">
    <link rel="stylesheet" href="css/nouislider.min.css">
    <link rel="stylesheet" href="css/ion.rangeSlider.css" />
    <link rel="stylesheet" href="css/ion.rangeSlider.skinFlat.css" />
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/main.css">
</head>

<style>
 .card-green {
   background-color: #ADD8E6;
 }
 .main {
   padding: 30px 0;
 }


 .dashboard-menu {
   background-color: #cce3e6;
   border-radius: 10px;
   padding: 15px;
   box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
 }


 .dashboard-menu .nav-link {
 font-weight: bold;
 color: #30683c;
 box-shadow: 0 4px 10px rgba(123, 131, 112, 0.3), 0 4px 20px rgba(0, 191, 255, 0.2);
 transition: box-shadow 0.3s ease;
}


.dashboard-menu .nav-link:hover {
 color: #00bfff;
 box-shadow: 0 4px 15px rgba(173, 255, 47, 0.5), 0 6px 25px rgba(0, 191, 255, 0.4);
}


 .card {
   border-radius: 10px;
   box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
   margin-bottom: 20px;
 }


 .card-header {
   background-color: #487379;
   color: white;
   border-radius: 10px 10px 0 0;
 }


 .btn-success {
   background-color: #577194;
   border-color: #6bb87d;
 }


 .btn-success:hover {
   background-color: #506955;
 }


 .form-group {
   margin-bottom: 15px;
 }


 .required {
   color: red;
 }


  @media (max-width: 768px) {
   .dashboard-menu {
     padding: 10px;
   }


   .card {
     margin-bottom: 15px;
   }
 }
 .page-header.breadcrumb-wrap {
 background-color: #eee2e9;
 padding: 15px 0;
}


.breadcrumb {
 display: flex;
 align-items: center;
 font-family: 'Arial', sans-serif;
 font-size: 16px;
 color: #121311;
}


.breadcrumb a {
 color: #007bff;
 text-decoration: none;
 position: relative;
 margin: 0 5px;
}


.breadcrumb a:hover {
 color: #0056b3;
}


.breadcrumb span {
 margin: 0 5px;
 color: #999;
}


.breadcrumb a::after {
 content: '';
 position: absolute;
 width: 100%;
 height: 2px;
 background: #6e6e3a;
 left: 0;
 bottom: -2px;
 transform: scaleX(0);
 transition: transform 0.3s ease;
}


.breadcrumb a:hover::after {
 transform: scaleX(1);
}

.profile-image-container {
        display: flex;
        align-items: center;
    }

    .rounded-circle {
        border-radius: 50%;
        border: 2px solid #fff; /* Optional: Add a border to the image */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Optional: Add a shadow effect */
    }

    .ml-3 {
        margin-left: 15px; /* Space between image and text */
    }

    
        body {
            background-color: #f7f7f7;
        }
        .sidebar {
            background-color: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .sidebar a {
            color: #333;
            display: block;
            padding: 10px 0;
            text-decoration: none;
        }
        .sidebar a.active {
            color: #ff6600;
        }
        .sidebar a:hover {
            color: #ff6600;
        }
        .sidebar a i {
            margin-right: 10px;
        }
        .main-content {
            background-color: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .main-content h2 {
            margin-bottom: 20px;
        }
        .form-group label {
            font-weight: bold;
        }
        .form-group span {
            color: red;
        }
        .btn-orange {
            background-color: #ff6600;
            color: white;
        }
        .btn-orange:hover {
            background-color: #e65c00;
        }
        .btn-blue {
            background-color: #0000ff;
            color: white;
        }
        .btn-blue:hover {
            background-color: #0000cc;
        }
        .photo img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .password-wrapper {
            position: relative;
            display: inline-block; /* Changed from block to inline-block */
            width: 55%; /* Match your input width */
        }

        .password-wrapper input {
            width: 100%; /* Make input fill the wrapper */
            padding-right: 40px; /* Add padding to prevent text overlap with icon */
        }

        .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            z-index: 1; /* Ensure icon stays above input */
        }
        #edit {
     margin-left: 20px;
    width: 129px;

}
.refer-earn-section {
    margin-top: 30px;
}

.referral-code-input {
    font-family: 'Courier New', monospace;
    font-weight: bold;
    font-size: 18px;
    text-align: center;
    background-color: #f8f9fa;
    border: 2px solid #28a745;
}

.earning-stats {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    padding: 20px;
    border-radius: 10px;
    margin-top: 10px;
}

.earning-stats h4 {
    margin: 0;
    font-size: 2rem;
}

.earning-stats p {
    margin: 5px 0;
}

.share-buttons .btn {
    margin-right: 10px;
    margin-bottom: 10px;
}

.card-header {
    border-bottom: 1px solid #28a745;
}

@media (max-width: 768px) {
    .earning-stats {
        margin-top: 20px;
    }
    
    .share-buttons .btn {
        width: 100%;
        margin-right: 0;
    }
}
.profile-image-wrapper {
  position: relative;
  display: inline-block;
  margin-bottom: 15px;
}

.profile-image {
  width: 150px;
  height: 150px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid #fff;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  transition: all 0.3s ease;
  cursor: pointer;
}

.profile-image:hover {
  transform: scale(1.05);
  box-shadow: 0 12px 35px rgba(0, 0, 0, 0.2);
}

.image-overlay {
  position: absolute;
  bottom: 10px;
  right: 10px;
  background: #487379;
  color: white;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
  border: 3px solid #fff;
}

.image-overlay:hover {
  background: #577194;
  transform: scale(1.1);
}

.image-overlay i {
  font-size: 18px;
}

.profile-info {
  margin: 20px 0;
}

.profile-name {
  color: #487379;
  font-weight: 600;
  margin: 0;
}

.profile-email {
  color: #6c757d;
  font-size: 14px;
  margin: 5px 0;
}

.profile-actions {
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
}

.btn-profile-primary {
  background: linear-gradient(135deg, #487379, #577194);
  border: none;
  color: white;
  padding: 10px 20px;
  border-radius: 25px;
  font-weight: 500;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(72, 115, 121, 0.3);
}

.btn-profile-primary:hover {
  background: linear-gradient(135deg, #577194, #487379);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(72, 115, 121, 0.4);
  color: white;
}

.btn-profile-secondary {
  background: linear-gradient(135deg, #6c757d, #5a6268);
  border: none;
  color: white;
  padding: 8px 16px;
  border-radius: 20px;
  font-weight: 500;
  font-size: 14px;
  transition: all 0.3s ease;
  box-shadow: 0 3px 10px rgba(108, 117, 125, 0.3);
}

.btn-profile-secondary:hover {
  background: linear-gradient(135deg, #5a6268, #6c757d);
  transform: translateY(-1px);
  box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
  color: white;
}

.btn-profile-danger {
  background: linear-gradient(135deg, #dc3545, #c82333);
  border: none;
  color: white;
  padding: 8px 16px;
  border-radius: 20px;
  font-weight: 500;
  font-size: 14px;
  transition: all 0.3s ease;
  box-shadow: 0 3px 10px rgba(220, 53, 69, 0.3);
}

.btn-profile-danger:hover {
  background: linear-gradient(135deg, #c82333, #dc3545);
  transform: translateY(-1px);
  box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
  color: white;
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
  .profile-image {
    width: 120px;
    height: 120px;
  }
  
  .image-overlay {
    width: 35px;
    height: 35px;
    bottom: 5px;
    right: 5px;
  }
  
  .image-overlay i {
    font-size: 16px;
  }
  
  .profile-actions {
    flex-direction: column;
    align-items: center;
  }
  
  .profile-actions .btn {
    width: 200px;
    margin: 5px 0;
  }
}

        
 
    </style>
</head>
<body>
    
<section class="banner-area organic-breadcrumb">
    <div class="container">
        <div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-between">
            <div class="col-left d-flex align-items-center">
                
                <div class="ml-3">
                    <h5 id="fullName" style="color: #121311;"><%= user.name %></h5>
                    <p id="email" style="color: #121311;"><%= user.email%></p>
                    
                </div>
            </div>
            <div class="col-first">
                <h1>User Profile</h1>
                <nav class="d-flex align-items-center">
                    <a href="/">Home<span class="lnr lnr-arrow-right"></span></a>
                    <a href="#">Profile</a>
                </nav>
            </div>
        </div>
    </div>
    <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="previewImage(event)">
</section>


    <div class="container mt-5">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 sidebar">
                <h2>My Account</h2>
                <a href="/userProfile" class="active"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                    <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10s-3.516.68-4.168 1.332c-.678.678-.83 1.418-.832 1.664z"/>
                  </svg> Account Details</a>
                <a href="/address"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-geo-alt" viewBox="0 0 16 16">
                    <path d="M12.166 8.94c-.524 1.062-1.234 2.12-1.96 3.07A32 32 0 0 1 8 14.58a32 32 0 0 1-2.206-2.57c-.726-.95-1.436-2.008-1.96-3.07C3.304 7.867 3 6.862 3 6a5 5 0 0 1 10 0c0 .862-.305 1.867-.834 2.94M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10"/>
                    <path d="M8 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4m0 1a3 3 0 1 0 0-6 3 3 0 0 0 0 6"/>
                  </svg> Address</a>
                <a href="/orders"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cart2" viewBox="0 0 16 16">
                    <path d="M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5M3.14 5l1.25 5h8.22l1.25-5zM5 13a1 1 0 1 0 0 2 1 1 0 0 0 0-2m-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0m9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2m-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0"/>
                  </svg> Orders</a>
                <a href="/wishlist"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart" viewBox="0 0 16 16">
                    <path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143q.09.083.176.171a3 3 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15"/>
                  </svg> Wishlist</a>
                <a href="/wallet"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-wallet-fill" viewBox="0 0 16 16">
                    <path d="M1.5 2A1.5 1.5 0 0 0 0 3.5v2h6a.5.5 0 0 1 .5.5c0 .253.08.644.306.958.207.288.557.542 1.194.542s.987-.254 1.194-.542C9.42 6.644 9.5 6.253 9.5 6a.5.5 0 0 1 .5-.5h6v-2A1.5 1.5 0 0 0 14.5 2z"/>
                    <path d="M16 6.5h-5.551a2.7 2.7 0 0 1-.443 1.042C9.613 8.088 8.963 8.5 8 8.5s-1.613-.412-2.006-.958A2.7 2.7 0 0 1 5.551 6.5H0v6A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5z"/>
                  </svg> Wallet</a>
                <a href="mycoupons"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cash" viewBox="0 0 16 16">
                    <path d="M8 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4"/>
                    <path d="M0 4a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1zm3 0a2 2 0 0 1-2 2v4a2 2 0 0 1 2 2h10a2 2 0 0 1 2-2V6a2 2 0 0 1-2-2z"/>
                  </svg> My Coupons</a>
                <a href="#" onclick="confirmLogout(event)" class="text-danger mt-4"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
            <!-- Main Content -->
            <div class="col-md-9 main-content">
                <h2>Personal Information</h2>
                
                    
           
<div class="profile-image-container text-center mb-4">
  <div class="profile-image-wrapper">
    <!-- Profile image in circle with enhanced styling -->
    <img id="profilePreview"
         src="<%= user.profilePicture ? '/uploads/' + user.profilePicture : '/default-avatar.png' %>"
         alt="Profile Image"
         class="profile-image">
    
    <!-- Camera overlay icon -->
    <div class="image-overlay" onclick="document.getElementById('profileImageInput').click()">
      <i class="bi bi-camera-fill"></i>
    </div>
  </div>

  <!-- Profile name and email under image -->
  <div class="profile-info mt-3">
    <h4 class="profile-name mb-1"><%= user.name %></h4>
    <p class="profile-email text-muted mb-2"><%= user.email %></p>
  </div>

  <!-- Hidden form for file upload -->
  <form id="uploadForm" action="/upload-profile-image" method="POST" enctype="multipart/form-data" style="display: none;">
    <input type="file" name="profileImage" id="profileImageInput" accept="image/*">
  </form>

  <!-- Action buttons -->
  <div class="profile-actions">
    <% if (!user.profilePicture) { %>
      <button class="btn btn-profile-primary" onclick="document.getElementById('profileImageInput').click()">
        <i class="bi bi-plus-circle me-2"></i>Add Photo
      </button>
    <% } else { %>
      <button class="btn btn-profile-secondary me-2" onclick="document.getElementById('profileImageInput').click()">
        <i class="bi bi-pencil-square me-2"></i>Change Photo
      </button>
      <button class="btn btn-profile-danger" onclick="removeProfileImage()">
        <i class="bi bi-trash me-2"></i>Remove
      </button>
    <% } %>
  </div>
</div>
                <form id="profileForm">

                    <div class="form-row" id = "profile-details">
                        <div class="form-group col-md-6">
                            <label>Full Name <span class="text-danger">*</span></label>
                            <input name="name" type="text" value="<%= user.name %>" class="form-control">
                        </div>
                        <div class="form-group col-md-6">
                            <label>Username <span class="text-danger">*</span></label>
                            <input name="username" type="text" value="<%= user.username %>" placeholder="Set your Username" class="form-control">
                            <small class="text-muted">Choose a unique username</small>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Email address</label>
                            <input type="email" value="<%= user.email %>" class="form-control" disabled>
                            <small class="text-muted">Email cannot be changed here</small>
                        </div>
                        <div class="form-group col-md-6">
                            <label>Phone Number <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <select class="form-control" id="countryCode" disabled>
                                        <option value="+91">+91</option>
                                    </select>
                                </div>
                                <input type="text" name="phone" class="form-control" value="<%= user.phone %>" 
                                       pattern="[0-9]{10}" title="Please enter a valid 10-digit phone number"
                                       placeholder="Enter phone number">
                            </div>
                        </div>
                        
                        <div class="form-group col-md-6">
                            <a class="btn btn-primary" href="/update-email">Change Your Email</a>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">Save Changes</button>
                </form>
                <hr class="mt-4 mb-4">
                <h3>Change Password</h3>
                <form id="changePasswordForm">
                    <div class="form-group">
                        <label for="currentPassword">Current Password</label><br>
                        <div class="password-wrapper">
                            <input type="password" class="form-control" id="currentPassword" name="currentPassword">
                            <i onclick="togglePassword('currentPassword', this)" class="bi bi-eye-fill toggle-password"></i>
                        </div><br>
                        <small id="currentPasswordError" class="text-danger"></small>
                    </div>
                    <div class="form-group mt-3">
                        <label for="newPassword">New Password</label><br>
                        <div class="password-wrapper">
                            <input type="password" class="form-control" id="newPassword" name="newPassword">
                            <i onclick="togglePassword('newPassword', this)" class="bi bi-eye-fill toggle-password"></i>
                        </div><br>
                        <small id="newPasswordError" class="text-danger"></small>
                    </div>
                    <div class="form-group mt-3">
                        <label for="confirmPassword">Confirm New Password</label><br>
                        <div class="password-wrapper">
                            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword">
                            <i onclick="togglePassword('confirmPassword', this)" class="bi bi-eye-fill toggle-password"></i>
                        </div><br>
                        <small id="confirmPasswordError" class="text-danger"></small>
                    </div>
                    <button type="submit" class="btn btn-primary mt-3">Change Password</button>
                </form>
                             <!-- Refer & Earn Section -->
<div class="refer-earn-section">
    <h3><i class="bi bi-gift"></i> Refer & Earn</h3>
    <div class="card border-success mb-3">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0"><i class="bi bi-share"></i> Share Your Referral Code</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-8">
                    <p class="card-text mb-3">
                        <strong>Your Referral Code:</strong>
                    </p>
                    <div class="input-group mb-3">
                        <input type="text" class="form-control referral-code-input" 
                               value="<%= user.referalCode %>" 
                               id="referralCodeInput" 
                               readonly>
                        <div class="input-group-append">
                            <button class="btn btn-outline-success" type="button" onclick="copyReferralCode()">
                                <i class="bi bi-clipboard"></i> Copy
                            </button>
                        </div>
                    </div>
                    <p class="text-muted">
                        <i class="bi bi-info-circle"></i> 
                        Share this code with your friends and earn <strong>₹100</strong> when they sign up using your code!
                    </p>
                </div>
                <div class="col-md-4 text-center">
                    <div class="earning-stats">
                        <h4 class="text-success">₹<%= user.wallet %></h4>
                        <p class="text-muted">Current Wallet Balance</p>
                        <p class="text-info">
                            <small><strong><%= user.redeemedUsers ? user.redeemedUsers.length : 0 %></strong> friends joined</small>
                        </p>
                    </div>
                </div>
            </div>
                
            </div>

        </div>
    </div>
   
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>


   
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
    <script>
        function removeProfileImage() {
  Swal.fire({
    title: 'Remove Profile Picture?',
    text: "This will remove your current profile picture",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#dc3545',
    cancelButtonColor: '#6c757d',
    confirmButtonText: 'Yes, remove it!'
  }).then((result) => {
    if (result.isConfirmed) {
      fetch('/remove-profile-image', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          document.getElementById('profilePreview').src = '/default-avatar.png';
          Swal.fire({
            icon: 'success',
            title: 'Removed!',
            text: 'Profile picture has been removed.',
            timer: 2000,
            showConfirmButton: false
          }).then(() => {
            location.reload(); // Reload to update the buttons
          });
        } else {
          Swal.fire({
            icon: 'error',
            title: 'Error',
            text: data.message || 'Failed to remove profile picture'
          });
        }
      })
      .catch(error => {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: 'Something went wrong'
        });
      });
    }
  });
}

  const fileInput = document.getElementById('profileImageInput');
  const preview = document.getElementById('profilePreview');
  const form = document.getElementById('uploadForm');

  fileInput.addEventListener('change', function () {
    const file = fileInput.files[0];
    if (file) {
      const reader = new FileReader();

      // Preview new image immediately
      reader.onload = function (e) {
        preview.src = e.target.result;
      };
      reader.readAsDataURL(file);

      // Submit form using AJAX (fetch)
      const formData = new FormData(form);

      fetch('/upload-profile-image', {
        method: 'POST',
        body: formData
      })
      .then(res => {
        if (res.ok) {
          Swal.fire({
            icon: 'success',
            title: 'Uploaded!',
            text: 'Image uploaded successfully',
            timer: 2000,
            showConfirmButton: false
          });
        } else {
          throw new Error('Upload failed');
        }
      })
      .catch(err => {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: err.message || 'Something went wrong'
        });
      });
    }
  });


function togglePassword(inputId, icon) {
    const input = document.getElementById(inputId);
    if (input.type === "password") {
        input.type = "text";
        icon.classList.add('bi-eye-slash-fill');
        icon.classList.remove('bi-eye-fill');
    } else {
        input.type = "password";
        icon.classList.add('bi-eye-fill');
        icon.classList.remove('bi-eye-slash-fill');
    }
}


 
    document.getElementById('changePasswordForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Reset error messages
    document.getElementById('currentPasswordError').textContent = '';
    document.getElementById('newPasswordError').textContent = '';
    document.getElementById('confirmPasswordError').textContent = '';

    const currentPassword = document.getElementById('currentPassword').value.trim();
    const newPassword = document.getElementById('newPassword').value.trim();
    const confirmPassword = document.getElementById('confirmPassword').value.trim();

    // Client-side validation
    let isValid = true;

    // Check if current password is empty
    if (!currentPassword) {
        document.getElementById('currentPasswordError').textContent = 'Current password is required.';
        isValid = false;
    }

    // Check if new password is empty
    if (!newPassword) {
        document.getElementById('newPasswordError').textContent = 'New password is required.';
        isValid = false;
    } else if (newPassword.length < 8 || !/[a-zA-Z]/.test(newPassword) || !/\d/.test(newPassword)) {
        document.getElementById('newPasswordError').textContent = 'Password must be at least 8 characters long and contain both letters and numbers.';
        isValid = false;
    }

    // Check if confirm password is empty
    if (!confirmPassword) {
        document.getElementById('confirmPasswordError').textContent = 'Please confirm your new password.';
        isValid = false;
    } else if (newPassword !== confirmPassword) {
        document.getElementById('confirmPasswordError').textContent = 'Passwords do not match.';
        isValid = false;
    }

    if (!isValid) return;

    try {
        const response = await fetch('/change-password', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ currentPassword, newPassword, confirmPassword }),
        });

        const result = await response.json();

        if (result.success) {
            await Swal.fire({
                icon: 'success',
                title: 'Success!',
                text: 'Password changed successfully',
                timer: 2000,
                showConfirmButton: false
            });
            window.location.href = '/userProfile';
        } else {
            if (result.error === 'current_password_incorrect') {
                document.getElementById('currentPasswordError').textContent = 'Current password is incorrect.';
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: result.message,
                });
            }
        }
    } catch (error) {
        console.error('Error:', error);
        Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'An unexpected error occurred. Please try again.',
        });
    }
});

function confirmLogout(event) {
        event.preventDefault(); // Prevent default link behavior

        Swal.fire({
            title: "Are you sure?",
            text: "You will be logged out!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Yes, Logout"
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = "/logout"; // Redirect only if confirmed
            }
        });
    }

    function confirmForgotPassword() {
            Swal.fire({
                title: "Are you sure?",
                text: "You'll be logged out to reset your password.",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "Yes, proceed",
                cancelButtonText: "Cancel",
                confirmButtonColor: "#d33",
                cancelButtonColor: "#3085d6"
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = "/forgot-password-logout"; 
                }
            });
        }

      
function previewImage(event) {
    const reader = new FileReader();
    reader.onload = function () {
        const output = document.getElementById('profileImage');
        output.src = reader.result;
    };
    reader.readAsDataURL(event.target.files[0]);
}


document.getElementById("profileForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const formData = {
    name: document.querySelector("input[name='name']").value,
    username: document.querySelector("input[name='username']").value,
    phone: document.querySelector("input[name='phone']").value,
  };

  try {
    const response = await fetch("/update-profile", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(formData)
    });

    const result = await response.json();

    if (result.success) {
      Swal.fire({
        icon: "success",
        title: "Success!",
        text: result.message
      });
    } else {
      Swal.fire({
        icon: "error",
        title: "Oops!",
        text: result.message
      });
    }
  } catch (error) {
    console.error("Error:", error);
    Swal.fire({
      icon: "error",
      title: "Something went wrong",
      text: "Failed to update profile"
    });
  }
});
</script>



 

<!-- Bootstrap JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>


<br><br>






