<%- include("../../views/partials/user/header") %>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <head>
    <link rel="stylesheet" href="css/linearicons.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/themify-icons.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/owl.carousel.css">
    <link rel="stylesheet" href="css/nice-select.css">
    <link rel="stylesheet" href="css/nouislider.min.css">
    <link rel="stylesheet" href="css/ion.rangeSlider.css" />
    <link rel="stylesheet" href="css/ion.rangeSlider.skinFlat.css" />
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/main.css">
</head>

<style>
 .card-green {
   background-color: #ADD8E6;
 }
 .main {
   padding: 30px 0;
 }


 .dashboard-menu {
   background-color: #cce3e6;
   border-radius: 10px;
   padding: 15px;
   box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
 }


 .dashboard-menu .nav-link {
 font-weight: bold;
 color: #30683c;
 box-shadow: 0 4px 10px rgba(123, 131, 112, 0.3), 0 4px 20px rgba(0, 191, 255, 0.2);
 transition: box-shadow 0.3s ease;
}


.dashboard-menu .nav-link:hover {
 color: #00bfff;
 box-shadow: 0 4px 15px rgba(173, 255, 47, 0.5), 0 6px 25px rgba(0, 191, 255, 0.4);
}


 .card {
   border-radius: 10px;
   box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
   margin-bottom: 20px;
 }


 .card-header {
   background-color: #487379;
   color: white;
   border-radius: 10px 10px 0 0;
 }


 .btn-success {
   background-color: #577194;
   border-color: #6bb87d;
 }


 .btn-success:hover {
   background-color: #506955;
 }


 .form-group {
   margin-bottom: 15px;
 }


 .required {
   color: red;
 }


  @media (max-width: 768px) {
   .dashboard-menu {
     padding: 10px;
   }


   .card {
     margin-bottom: 15px;
   }
 }
 .page-header.breadcrumb-wrap {
 background-color: #eee2e9;
 padding: 15px 0;
}


.breadcrumb {
 display: flex;
 align-items: center;
 font-family: 'Arial', sans-serif;
 font-size: 16px;
 color: #121311;
}


.breadcrumb a {
 color: #007bff;
 text-decoration: none;
 position: relative;
 margin: 0 5px;
}


.breadcrumb a:hover {
 color: #0056b3;
}


.breadcrumb span {
 margin: 0 5px;
 color: #999;
}


.breadcrumb a::after {
 content: '';
 position: absolute;
 width: 100%;
 height: 2px;
 background: #6e6e3a;
 left: 0;
 bottom: -2px;
 transform: scaleX(0);
 transition: transform 0.3s ease;
}


.breadcrumb a:hover::after {
 transform: scaleX(1);
}

.profile-image-container {
        display: flex;
        align-items: center;
    }

    .rounded-circle {
        border-radius: 50%;
        border: 2px solid #fff; /* Optional: Add a border to the image */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Optional: Add a shadow effect */
    }

    .ml-3 {
        margin-left: 15px; /* Space between image and text */
    }

</style>
 <section class="banner-area organic-breadcrumb">
    <div class="container">
        <div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
            <div class="col-first">
                <h1>Wishlist</h1>
                <nav class="d-flex align-items-center">
                    <a href="/">Home<span class="lnr lnr-arrow-right"></span></a>
                    <a href="/wishlist">Wishlist</a>
                </nav>
            </div>
        </div>
    </div>
</section>
<!-- End Banner Area -->



<main class="main">


   <br><br>

   <section class="mt-50 mb-50">
       <div class="container">
           <div class="row">
               <div class="col-12">
                   <div class="table-responsive">
                       <table class="table shopping-summery text-center clean">
                           <thead>
                               <tr class="main-heading">
                                   <th scope="col">Image</th>
                                   <th scope="col">Name</th>
                                   <th scope="col">Size</th>
                                   <th scope="col">Price</th>
                                   <th scope="col">Add to Cart</th>
                                   <th scope="col">Remove</th>
                               </tr>
                           </thead>
                           <tbody>

                                <%if(wishlist.length>0){%>

                                    <%for(let item of wishlist){%>
                                        <%if(item.productId && item.productId.productImage){%>
                                       <tr>
                                           <td class="image product-thumbnail">
                                               <img src="<%= item.productId.productImage[0] %>" alt="<%= item.productId.productName %>" style="width: 80px; height: 80px; object-fit: cover;" />
                                           </td>
                                           <td class="product-des product-name">
                                               <h5 class="product-name">
                                                   <a href="/productDetails?id=<%=item.productId._id%>">
                                                      <%=item.productId.productName%>
                                                   </a>
                                               </h5>
                                               <p class="font-xs">
                                                <%=item.productId.category.name%>
                                                   <br />
                                                   <%=item.productId.brand || 'N/A'%>
                                               </p>
                                           </td>
                                           <td class="size" data-title="Size">
                                               <span class="badge badge-secondary"><%=item.size%></span>
                                           </td>
                                           <td class="price" data-title="Price">â‚¹<span>
                                            <%=item.productId.salePrice%>
                                           </span></td>
                                           <td class="text-center" data-title="Add to Cart">
                                              <a href="#" onclick="addToCartFromWishlist('<%= item.productId._id %>', '<%= item.size%>')" class="btn btn-sm btn-primary">Add to Cart</a>

                                           </td>
                                           <td class="action" data-title="Remove">
                                               <a class="btn btn-sm btn-danger" href="#" onclick="confirmRemove('<%=item.productId._id%>', '<%=item.size%>')">
                                                   <i class="fi-rs-trash">Remove</i>
                                               </a>
                                           </td>
                                       </tr>
                                       <%}else{%>
                                           <!-- Skip items with missing product data -->
                                       <%}%>
                                       <%}%>
                                       <%}else{%>
                                   <tr>
                                       <td colspan="6" class="text-center">
                                           <div class="empty-wishlist" style="padding: 40px 20px;">
                                               <i class="lnr lnr-heart" style="font-size: 48px; color: #ccc; margin-bottom: 20px;"></i>
                                               <p class="lead mb-4">Your wishlist is empty</p>
                                               <a href="/shop" class="btn btn-primary">Continue Shopping</a>
                                           </div>
                                       </td>
                                   </tr>
                                   <%}%>
                           </tbody>
                       </table>
                   </div>
               </div>
           </div>
       </div>
   </section>
</main>
<%- include("../../views/partials/user/footer") %>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function confirmRemove(productId, size){
        Swal.fire({
            title:"Are You sure?",
            text:"You won't be able to revert this",
            icon:"warning",
            showCancelButton:true,
            confirmButtonColor:"#3085d6",
            cancelButtonColor:"#d33",
            confirmButtonText:"Yes, remove it!",

        }).then((result) => {
            if(result.isConfirmed){
                window.location.href = `/removeFromWishList?productId=${productId}&size=${encodeURIComponent(size)}`;
            }
        })
    }


function addToCartFromWishlist(productId, size) {
  // Show loading state
  Swal.fire({
    title: 'Adding to Cart...',
    text: 'Please wait',
    allowOutsideClick: false,
    showConfirmButton: false,
    willOpen: () => {
      Swal.showLoading();
    }
  });

  $.ajax({
    url: '/addToCartFromWishList',
    method: "POST",
    data: { 
      productId: productId,
      size: size
    },
    success: (response) => {
      Swal.close();
      
      if (response.status) {
        Swal.fire({
          icon: 'success',
          title: 'Success!',
          text: response.message,
          timer: 2000,
          showConfirmButton: false
        }).then(() => {
          location.reload();
        });
      } else {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: response.message
        });
      }
    },
    error: (xhr) => {
      Swal.close();
      
      if (xhr.status === 401) {
        Swal.fire({
          title: "Login Required",
          text: "Please login to add items to cart",
          icon: "warning",
          confirmButtonText: "Login"
        }).then((result) => {
          if (result.isConfirmed) {
            window.location.href = '/login';
          }
        });
      } else {
        Swal.fire({
          icon: 'error',
          title: 'Server Error',
          text: xhr.responseJSON?.message || 'Failed to add item to cart'
        });
      }
    }
  });
}

</script>